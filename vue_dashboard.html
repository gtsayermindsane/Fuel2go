<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuel2go - Vue Dashboard</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .dashboard {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            height: 600px;
        }

        .map-container {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .sidebar {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .route-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .route-card:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .route-card.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .route-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.9rem;
        }

        .metric-value {
            font-weight: bold;
        }

        .controls {
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn.active {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }

        .emission-high { color: #dc3545; }
        .emission-medium { color: #ffc107; }
        .emission-low { color: #28a745; }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.5s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .map-container {
                height: 400px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="dashboard">
            <div class="header">
                <h1>üöó Fuel2go Dashboard</h1>
                <p>{{ currentTime }} - {{ routes.length }} rota analiz edildi</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">{{ totalDistance }}km</div>
                    <div class="stat-label">Toplam Mesafe</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ totalSavings }}kg</div>
                    <div class="stat-label">CO2 Tasarrufu</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ averageEfficiency }}%</div>
                    <div class="stat-label">Ortalama Verimlilik</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ totalCostSavings }}‚Ç∫</div>
                    <div class="stat-label">Maliyet Tasarrufu</div>
                </div>
            </div>

            <div class="main-content">
                <div class="map-container">
                    <div id="map"></div>
                </div>

                <div class="sidebar">
                    <div class="controls">
                        <h3>üéõÔ∏è Kontroller</h3>
                        <button 
                            class="btn" 
                            :class="{ active: viewMode === 'all' }"
                            @click="setViewMode('all')"
                        >
                            T√ºm Rotalar
                        </button>
                        <button 
                            class="btn"
                            :class="{ active: viewMode === 'best' }"
                            @click="setViewMode('best')"
                        >
                            En ƒ∞yi Rota
                        </button>
                        <button 
                            class="btn"
                            :class="{ active: emissionView }"
                            @click="toggleEmissionView"
                        >
                            {{ emissionView ? 'Normal G√∂r√ºn√ºm' : 'Emisyon G√∂r√ºn√ºm√º' }}
                        </button>
                    </div>

                    <div v-if="loading" class="loading">
                        <p>üì° Veri y√ºkleniyor...</p>
                    </div>

                    <transition-group name="fade" tag="div" v-else>
                        <div 
                            v-for="route in routes" 
                            :key="route.id"
                            class="route-card"
                            :class="{ active: activeRoute === route.id }"
                            :style="{ borderLeftColor: route.color }"
                            @click="selectRoute(route)"
                        >
                            <div class="route-title">{{ route.name }}</div>
                            <div class="metric">
                                <span>üìè Mesafe:</span>
                                <span class="metric-value">{{ route.distance }}km</span>
                            </div>
                            <div class="metric">
                                <span>‚è±Ô∏è S√ºre:</span>
                                <span class="metric-value">{{ formatDuration(route.duration) }}</span>
                            </div>
                            <div class="metric">
                                <span>‚õΩ Benzinli CO2:</span>
                                <span class="metric-value emission-high">{{ route.emissions.gasoline }}kg</span>
                            </div>
                            <div class="metric">
                                <span>‚ö° Elektrikli CO2:</span>
                                <span class="metric-value emission-low">{{ route.emissions.electric }}kg</span>
                            </div>
                            <div class="metric">
                                <span>üå± Tasarruf:</span>
                                <span class="metric-value emission-low">
                                    {{ (route.emissions.gasoline - route.emissions.electric).toFixed(1) }}kg
                                    ({{ Math.round(((route.emissions.gasoline - route.emissions.electric) / route.emissions.gasoline) * 100) }}%)
                                </span>
                            </div>
                        </div>
                    </transition-group>

                    <div style="margin-top: 20px;">
                        <h3>üå± Ara√ß Kar≈üƒ±la≈ütƒ±rmasƒ±</h3>
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Ara√ß Tipi</th>
                                    <th>Fakt√∂r</th>
                                    <th>√ñrnek CO2</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>üöó Benzinli</td>
                                    <td>0.192 kg/km</td>
                                    <td class="emission-high">85.5kg</td>
                                </tr>
                                <tr>
                                    <td>üöõ Dizel</td>
                                    <td>0.171 kg/km</td>
                                    <td class="emission-medium">76.2kg</td>
                                </tr>
                                <tr>
                                    <td>üîã Hibrit</td>
                                    <td>0.104 kg/km</td>
                                    <td class="emission-medium">46.3kg</td>
                                </tr>
                                <tr>
                                    <td>‚ö° Elektrikli</td>
                                    <td>0.067 kg/km</td>
                                    <td class="emission-low">29.8kg</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // Reactive data
                const routes = ref([]);
                const activeRoute = ref(null);
                const viewMode = ref('all');
                const emissionView = ref(false);
                const loading = ref(true);
                const currentTime = ref('');
                let map = null;
                let routeLines = [];
                let markers = [];

                // Cities data
                const cities = {
                    istanbul: { lat: 41.0082, lng: 28.9784, name: 'ƒ∞stanbul' },
                    ankara: { lat: 39.9334, lng: 32.8597, name: 'Ankara' },
                    izmir: { lat: 38.4192, lng: 27.1287, name: 'ƒ∞zmir' }
                };

                // Computed properties
                const totalDistance = computed(() => {
                    return routes.value.reduce((sum, route) => sum + route.distance, 0).toFixed(0);
                });

                const totalSavings = computed(() => {
                    return routes.value.reduce((sum, route) => 
                        sum + (route.emissions.gasoline - route.emissions.electric), 0
                    ).toFixed(1);
                });

                const averageEfficiency = computed(() => {
                    if (routes.value.length === 0) return 0;
                    const avg = routes.value.reduce((sum, route) => {
                        const efficiency = ((route.emissions.gasoline - route.emissions.electric) / route.emissions.gasoline) * 100;
                        return sum + efficiency;
                    }, 0) / routes.value.length;
                    return Math.round(avg);
                });

                const totalCostSavings = computed(() => {
                    return routes.value.reduce((sum, route) => 
                        sum + (route.fuel_cost - route.electric_cost), 0
                    ).toFixed(0);
                });

                // Methods
                const initializeData = () => {
                    // Simulate API call
                    setTimeout(() => {
                        routes.value = [
                            {
                                id: 'istanbul_ankara',
                                name: 'ƒ∞stanbul ‚Üí Ankara',
                                origin: cities.istanbul,
                                destination: cities.ankara,
                                distance: 445.4,
                                duration: 285,
                                emissions: {
                                    gasoline: 85.5,
                                    diesel: 76.2,
                                    hybrid: 46.3,
                                    electric: 29.8
                                },
                                fuel_cost: 1242,
                                electric_cost: 223,
                                color: '#e74c3c'
                            },
                            {
                                id: 'istanbul_izmir',
                                name: 'ƒ∞stanbul ‚Üí ƒ∞zmir',
                                origin: cities.istanbul,
                                destination: cities.izmir,
                                distance: 565,
                                duration: 390,
                                emissions: {
                                    gasoline: 108.5,
                                    diesel: 96.6,
                                    hybrid: 58.8,
                                    electric: 37.9
                                },
                                fuel_cost: 1575,
                                electric_cost: 283,
                                color: '#3498db'
                            },
                            {
                                id: 'ankara_izmir',
                                name: 'Ankara ‚Üí ƒ∞zmir',
                                origin: cities.ankara,
                                destination: cities.izmir,
                                distance: 320,
                                duration: 240,
                                emissions: {
                                    gasoline: 61.4,
                                    diesel: 54.7,
                                    hybrid: 33.3,
                                    electric: 21.4
                                },
                                fuel_cost: 896,
                                electric_cost: 160,
                                color: '#2ecc71'
                            }
                        ];
                        loading.value = false;
                        updateMap();
                    }, 1000);
                };

                const initializeMap = () => {
                    map = L.map('map').setView([39.9334, 32.8597], 6);
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors'
                    }).addTo(map);

                    // Add city markers
                    Object.values(cities).forEach(city => {
                        const marker = L.marker([city.lat, city.lng])
                            .bindPopup(`<b>${city.name}</b>`)
                            .addTo(map);
                        markers.push(marker);
                    });
                };

                const updateMap = () => {
                    // Clear existing route lines
                    routeLines.forEach(line => map.removeLayer(line));
                    routeLines = [];

                    // Add route lines
                    routes.value.forEach(route => {
                        const line = L.polyline([
                            [route.origin.lat, route.origin.lng],
                            [route.destination.lat, route.destination.lng]
                        ], {
                            color: route.color,
                            weight: 4,
                            opacity: 0.7
                        }).addTo(map);

                        line.bindPopup(`
                            <div style="min-width: 200px;">
                                <h4>${route.name}</h4>
                                <p><strong>Mesafe:</strong> ${route.distance} km</p>
                                <p><strong>S√ºre:</strong> ${formatDuration(route.duration)}</p>
                                <p><strong>CO2 (Benzinli):</strong> ${route.emissions.gasoline} kg</p>
                                <p><strong>CO2 (Elektrikli):</strong> ${route.emissions.electric} kg</p>
                                <p><strong>Tasarruf:</strong> ${(route.emissions.gasoline - route.emissions.electric).toFixed(1)} kg</p>
                            </div>
                        `);

                        routeLines.push(line);
                    });
                };

                const formatDuration = (minutes) => {
                    const hours = Math.floor(minutes / 60);
                    const mins = minutes % 60;
                    return `${hours}s ${mins}d`;
                };

                const selectRoute = (route) => {
                    activeRoute.value = activeRoute.value === route.id ? null : route.id;
                    
                    if (activeRoute.value) {
                        map.fitBounds([
                            [route.origin.lat, route.origin.lng],
                            [route.destination.lat, route.destination.lng]
                        ], { padding: [20, 20] });
                    }
                };

                const setViewMode = (mode) => {
                    viewMode.value = mode;
                    
                    if (mode === 'all') {
                        map.fitBounds([
                            [cities.istanbul.lat, cities.istanbul.lng],
                            [cities.izmir.lat, cities.izmir.lng]
                        ], { padding: [20, 20] });
                    } else if (mode === 'best') {
                        const bestRoute = routes.value.reduce((best, current) => 
                            current.emissions.electric < best.emissions.electric ? current : best
                        );
                        selectRoute(bestRoute);
                    }
                };

                const toggleEmissionView = () => {
                    emissionView.value = !emissionView.value;
                    
                    routeLines.forEach((line, index) => {
                        const route = routes.value[index];
                        if (emissionView.value) {
                            const intensity = route.emissions.electric / 50;
                            line.setStyle({
                                color: intensity > 0.6 ? '#e74c3c' : intensity > 0.3 ? '#f39c12' : '#27ae60',
                                weight: 6
                            });
                        } else {
                            line.setStyle({
                                color: route.color,
                                weight: 4
                            });
                        }
                    });
                };

                const updateTime = () => {
                    const now = new Date();
                    currentTime.value = `Son g√ºncelleme: ${now.toLocaleTimeString('tr-TR')}`;
                };

                // Lifecycle
                onMounted(() => {
                    initializeMap();
                    initializeData();
                    updateTime();
                    
                    // Update time every 30 seconds
                    setInterval(updateTime, 30000);
                });

                // Watch for route changes
                watch(routes, () => {
                    if (routes.value.length > 0) {
                        updateMap();
                    }
                }, { deep: true });

                return {
                    routes,
                    activeRoute,
                    viewMode,
                    emissionView,
                    loading,
                    currentTime,
                    totalDistance,
                    totalSavings,
                    averageEfficiency,
                    totalCostSavings,
                    formatDuration,
                    selectRoute,
                    setViewMode,
                    toggleEmissionView
                };
            }
        }).mount('#app');
    </script>
</body>
</html>